var ptssStructurePress=ptssStructurePress||{};ptssStructurePress.events={};_.extend(ptssStructurePress.events,Backbone.Events);jQuery(document).ready(function($){new ptssStructurePress.frameView({el:".js-ptss-frame",model:new ptssStructurePress.Frame});new ptssStructurePress.customizerCSS({el:"#structurepress-woocommerce-inline-css"});new ptssStructurePress.pageLayoutView({el:"#ptss__layout",model:ptssStructurePress.PageLayout});new ptssStructurePress.navPositionView({el:"#ptss__nav-position",model:new ptssStructurePress.NavPosition});new ptssStructurePress.colorPaletteView({el:"#ptss__color-skin"});new ptssStructurePress.bgImgsView({el:"#ptss__boxed-bg"})});(function(){var $=jQuery;ptssStructurePress.Frame=Backbone.Model.extend({defaults:{isVisible:false},initialize:function(){var current=localStorage.getItem(ptssVars.siteId+"_isVisible");if(null===current){this.set("isVisible",true);setTimeout(_.bind(this.toggleVisibility,this),2e3)}else{this.set("isVisible","true"===current)}},toggleVisibility:function(){this.set("isVisible",!this.get("isVisible"));localStorage.setItem(ptssVars.siteId+"_isVisible",this.get("isVisible"))}});ptssStructurePress.frameView=Backbone.View.extend({events:{"click .js-ptss-toggle-btn":"toggleVisibility"},initialize:function(){this.listenTo(this.model,"change",this.toggleClass);this.$el.show();this.model.trigger("change")},toggleVisibility:function(){this.model.toggleVisibility();if("undefined"!==typeof ga){ga("send","event","Style Switcher","Toggle Visibility",this.model.get("isVisible")?"Opened":"Closed")}},toggleClass:function(){this.$el.toggleClass("is-opened",this.model.get("isVisible"))}});(function(){var Layout=Backbone.Model.extend({defaults:{isBoxed:false},initialize:function(){this.listenTo(this,"change",this.bodyClass);this.set("isBoxed","true"===localStorage.getItem(ptssVars.siteId+"_isBoxed"))},switchLayout:function(){this.set("isBoxed",!this.get("isBoxed"));localStorage.setItem(ptssVars.siteId+"_isBoxed",this.get("isBoxed"));ptssStructurePress.events.trigger("toggleLayoutStyle",this.get("isBoxed"));$(window).trigger("resize")},bodyClass:function(){$("body").toggleClass("boxed",this.get("isBoxed"))}});ptssStructurePress.PageLayout=new Layout})();ptssStructurePress.NavPosition=Backbone.Model.extend({defaults:{isSticky:false},initialize:function(){this.listenTo(this,"change",this.updateNavPosition);this.set("isSticky","true"===localStorage.getItem(ptssVars.siteId+"_isSticky"))},toggleNavPosition:function(){this.set("isSticky",!this.get("isSticky"));localStorage.setItem(ptssVars.siteId+"_isSticky",this.get("isSticky"))},updateNavPosition:function(){$("body").toggleClass("sticky-navigation",this.get("isSticky"));$("body").trigger("update_sticky_state.pt")}});ptssStructurePress.ColorSkin=Backbone.Model.extend({defaults:{isSelected:false,color:""},initialize:function(){this.listenTo(this,"change:isSelected",this.applySkin)},applySkin:function(){if(this.get("isSelected")){ptssStructurePress.events.trigger("updateCSS");localStorage.setItem(ptssVars.siteId+"_colorSkin",this.get("color"))}}});ptssStructurePress.colorPaletteCollection=Backbone.Collection.extend({model:ptssStructurePress.ColorSkin,initialize:function(){setTimeout(_.bind(this.setDefaultSkin,this),20)},setDefaultSkin:function(){var current=localStorage.getItem(ptssVars.siteId+"_colorSkin");if(null===current){this.first().set("isSelected",true)}else{this.find(function(colorSkin){return current===colorSkin.get("color")}).set("isSelected",true)}}});ptssStructurePress.colorPalette=new ptssStructurePress.colorPaletteCollection([{color:"default",css:{primary:"#edac15",primaryDarken1:"#ebaa12",primaryDarken5:"#d89c11"}},{color:"red",css:{primary:"#ce2e2e",primaryDarken1:"#c82d2d",primaryDarken5:"#b72929"}},{color:"blue",css:{primary:"#355d9a",primaryDarken1:"#335994",primaryDarken5:"#2e5085"}},{color:"bordeaux",css:{primary:"#842b45",primaryDarken1:"#7f2942",primaryDarken5:"#70243a"}},{color:"orange",css:{primary:"#e25514",primaryDarken1:"#dc5313",primaryDarken5:"#c94c12"}}]);ptssStructurePress.BgImage=Backbone.Model.extend({defaults:{isSelected:false,repeatable:false,name:"",src:{}},initialize:function(){this.listenTo(this,"change:isSelected",this.updateBgImage)},updateBgImage:function(){if(this.get("isSelected")){ptssStructurePress.events.trigger("updateBgImage");localStorage.setItem(ptssVars.siteId+"_bgImage",this.get("name"));$("body").css("background-image",'url("'+ptssVars.pathToPlugin+"assets/img/"+this.get("src")+'")')}}});ptssStructurePress.bgImgsCollection=Backbone.Collection.extend({model:ptssStructurePress.BgImage,initialize:function(){setTimeout(_.bind(this.setDefaultBg,this),20)},setDefaultBg:function(){var current=localStorage.getItem(ptssVars.siteId+"_bgImage");if(null===current){this.first().set("isSelected",true)}else{this.find(function(bgImg){return current===bgImg.get("name")}).set("isSelected",true)}}});ptssStructurePress.bgImgs=new ptssStructurePress.bgImgsCollection([{name:"pattern1",src:"1.png",sprite:1},{name:"pattern2",src:"2.png",sprite:2},{name:"pattern3",src:"3.png",sprite:3},{name:"pattern4",src:"4.png",sprite:4}]);ptssStructurePress.pageLayoutView=Backbone.View.extend({events:{"click .ptss__layout-box--wide":"changeToWide","click .ptss__layout-box--boxed":"changeToBoxed"},template:_.template($("#ptss-layout-tmpl").html()),initialize:function(){this.listenTo(this.model,"change",this.render);this.render();return this},render:function(){this.$(".ptss__setting-control").html(this.template(this.model.attributes));return this},changeToWide:function(ev){if(this.model.get("isBoxed")){this.model.switchLayout()}$("body").css("background-image","none");return this},changeToBoxed:function(ev){if(!this.model.get("isBoxed")){this.model.switchLayout()}return this}});ptssStructurePress.navPositionView=Backbone.View.extend({events:{"click .ptss__setting-control":"changeNavPosition"},template:_.template($("#ptss-nav-tmpl").html()),initialize:function(){this.listenTo(this.model,"change",this.render);this.render();return this},render:function(){this.$(".ptss__setting-control").html(this.template(this.model.attributes));return this},changeNavPosition:function(){this.model.toggleNavPosition();return this}});ptssStructurePress.colorSkinView=Backbone.View.extend({events:{click:"changeToThisSkin"},template:'<i class="fa fa-check"></i>',tagName:"span",className:"ptss__color-option",initialize:function(){this.listenTo(this.model,"change:isSelected",this.updateSelected);this.model.trigger("change:isSelected");return this},render:function(){this.$el.html(this.template);this.$el.css("background-color",this.model.attributes.css.primary);return this},changeToThisSkin:function(){ptssStructurePress.colorPalette.each(function(colorSkin){colorSkin.set("isSelected",false)});this.model.set("isSelected",true);return this},updateSelected:function(){this.$el.toggleClass("is-selected",this.model.get("isSelected"));return this}});ptssStructurePress.colorPaletteView=Backbone.View.extend({initialize:function(){ptssStructurePress.colorPalette.each(this.addColorSkin,this);return this},addColorSkin:function(colorSkin){var skinView=new ptssStructurePress.colorSkinView({model:colorSkin});this.$el.append(skinView.render().el)}});ptssStructurePress.bgImgView=Backbone.View.extend({events:{click:"changeToThisBgImg"},template:'<i class="fa fa-check"></i>',tagName:"span",className:"ptss__bgimg-option",initialize:function(){this.listenTo(this.model,"change:isSelected",this.updateSelected);this.model.trigger("change:isSelected");return this},render:function(){this.$el.html(this.template);this.$el.css("background-position","-"+(this.model.get("sprite")-1)*40+"px 0");return this},changeToThisBgImg:function(){ptssStructurePress.bgImgs.each(function(bgImg){bgImg.set("isSelected",false)});this.model.set("isSelected",true);return this},updateSelected:function(){this.$el.toggleClass("is-selected",this.model.get("isSelected"));return this}});ptssStructurePress.bgImgsView=Backbone.View.extend({initialize:function(){this.listenTo(ptssStructurePress.events,"toggleLayoutStyle",this.toggleVisibility);ptssStructurePress.bgImgs.each(this.addBgImgs,this);this.toggleVisibility(ptssStructurePress.PageLayout.get("isBoxed"));return this},addBgImgs:function(bgImg){var bgImgView=new ptssStructurePress.bgImgView({model:bgImg});this.$("#ptss__boxed-backgrounds").append(bgImgView.render().el)},toggleVisibility:function(isBoxed){this.$el.toggle(isBoxed)}});ptssStructurePress.customizerCSS=Backbone.View.extend({initialize:function(){this.listenTo(ptssStructurePress.events,"updateCSS",this.render);this.initialCSS=this.$el.text();this.defaultSkin=ptssStructurePress.colorPalette.findWhere({color:"default"});this.template=this.createTemplate(this.initialCSS);return this},createTemplate:function(templateString){_.each(this.defaultSkin.get("css"),function(hexColor,keyName){templateString=templateString.replace(new RegExp(hexColor,"g"),"<%= "+keyName+" %>")},this);templateString=templateString+' .fa[style*="edac15"] {color: <%= primary %> !important;}';return _.template(templateString)},render:function(){var selectedSkin=ptssStructurePress.colorPalette.findWhere({isSelected:true});if(selectedSkin===this.defaultSkin){this.$el.text(this.initialCSS)}else{this.$el.text(this.template(selectedSkin.get("css")))}return this}})})();